<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Checkout - Scented</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="styles.css" />
    <style>
      .checkout-wrapper {
        max-width: 1100px;
        margin: 20px auto;
        display: grid;
        grid-template-columns: 1fr 360px;
        gap: 20px;
      }
      .checkout-form {
        background: #fff;
        padding: 20px;
        border-radius: 8px;
      }
      .field {
        margin-bottom: 15px;
      }
      .field label {
        display: block;
        margin-bottom: 6px;
      }
      .field input {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
      .btn {
        background: #ff6f61;
        color: #fff;
        border: none;
        padding: 12px 20px;
        border-radius: 4px;
        cursor: pointer;
        width: 100%;
      }
      .order-summary {
        background: #fff;
        padding: 20px;
        border-radius: 8px;
      }
      .cart-items {
        list-style: none;
        padding: 0;
        margin: 0 0 20px 0;
      }
      .cart-items li {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid #eee;
      }
      @media (max-width: 768px) {
        .checkout-wrapper {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <h1>Checkout</h1>

    <div class="checkout-wrapper">
      <div class="checkout-form">
        <h2>Shipping Information</h2>
        <form id="shippingForm" onsubmit="handleSubmit(event)">
          <div class="field">
            <label for="name">Full Name</label>
            <input type="text" id="name" name="name" required />
          </div>

          <div class="field">
            <label for="email">Email Address</label>
            <input type="email" id="email" name="email" required />
          </div>

          <div class="field">
            <label for="phone">Phone Number</label>
            <input type="tel" id="phone" name="phone" required />
          </div>

          <div class="field">
            <label for="address">Delivery Address</label>
            <input type="text" id="address" name="address" required />
          </div>

          <div class="field">
            <label for="city">City</label>
            <input type="text" id="city" name="city" required />
          </div>

          <div class="field">
            <label for="postal">Postal Code</label>
            <input type="text" id="postal" name="postal" required />
          </div>

          <button type="submit" class="btn">Continue to Payment</button>
        </form>
      </div>

      <div class="order-summary">
        <h3>Order Summary</h3>
        <ul id="checkout-cart" class="cart-items"></ul>
        <div class="totals">
          <p>Subtotal: R<span id="subtotal">0.00</span></p>
          <p>Shipping: R<span id="shipping">100.00</span></p>
          <h3>Total: R<span id="total">0.00</span></h3>
        </div>
      </div>
    </div>

    <script>
      function formatCurrency(num) {
        return Number(num).toFixed(2);
      }

      function handleSubmit(event) {
        event.preventDefault();

        // Get form data
        const formData = {
          name: document.getElementById("name").value,
          email: document.getElementById("email").value,
          phone: document.getElementById("phone").value,
          address: document.getElementById("address").value,
          city: document.getElementById("city").value,
          postal: document.getElementById("postal").value,
        };

        // Save shipping info and cart data to session storage
        sessionStorage.setItem("shippingInfo", JSON.stringify(formData));
        sessionStorage.setItem(
          "checkoutData",
          JSON.stringify({
            cart: JSON.parse(localStorage.getItem("shopCart")) || [],
            totals: {
              subtotal: document.getElementById("subtotal").textContent,
              shipping: document.getElementById("shipping").textContent,
              total: document.getElementById("total").textContent,
            },
          })
        );

        // Redirect to payment page
        window.location.href = "payment-details.html";
      }

      function updateCheckoutDisplay() {
        const cart = JSON.parse(localStorage.getItem("shopCart")) || [];
        const list = document.getElementById("checkout-cart");
        list.innerHTML = "";

        let subtotal = 0;

        if (cart.length === 0) {
          list.innerHTML = "<li>Cart is empty</li>";
        } else {
          cart.forEach((item) => {
            const quantity = Number(item.quantity) || 1;
            const price = Number(item.price) || 0;
            const itemTotal = price * quantity;
            subtotal += itemTotal;

            const li = document.createElement("li");
            li.innerHTML = `
              <span>${item.name} Ã— ${quantity}</span>
              <span>R${formatCurrency(itemTotal)}</span>
            `;
            list.appendChild(li);
          });
        }

        const shipping = cart.length > 0 ? 100 : 0;
        const total = subtotal + shipping;

        document.getElementById("subtotal").textContent =
          formatCurrency(subtotal);
        document.getElementById("shipping").textContent =
          formatCurrency(shipping);
        document.getElementById("total").textContent = formatCurrency(total);
      }

      document.addEventListener("DOMContentLoaded", updateCheckoutDisplay);
    </script>
  </body>
</html>
